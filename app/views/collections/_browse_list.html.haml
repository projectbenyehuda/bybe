%div#spinnerdiv{style: 'display: none; top: 50%; left: 50%;'}
  #floatingCirclesG
    #frotateG_01.f_circleG
    #frotateG_02.f_circleG
    #frotateG_03.f_circleG
    #frotateG_04.f_circleG
    #frotateG_05.f_circleG
    #frotateG_06.f_circleG
    #frotateG_07.f_circleG
    #frotateG_08.f_circleG

.by-card-header-v02
  .headline-2-v02= t(:x_collections_plain, x: @total)
  .filters
    - @filters.each do |f, id, which|
      %button.tag
        = f
        %span.pointer.tag-x{'data-ele': id, 'data-which' => which}= '-'
.by-card-content-v02
  = render partial: 'shared/filters/pagination', locals: { form_id: 'collections_filters', add_js: false }
  %hr
  .select-all-with-buttons.desktop-only
    .headline-4-v02= t(:sort_by)
    #sort-by
      %div
        #custom-select{title: t(:collections_sort_tt)}
          %select#sort_by_dd{name: 'sort_by'}
            %optgroup{ label: t(:alefbet) }
              %option{ value: 'alphabetical_asc', selected: @sort == 'alphabetical_asc' }
                = t(:alefbet_asc)
              %option{ value: 'alphabetical_desc', selected: @sort == 'alphabetical_desc' }
                = t(:alefbet_desc)
            %optgroup{ label: t(:popularity_group) }
              %option{ value: 'popularity_desc', selected: @sort == 'popularity_desc' }
                = t(:popularity_desc)
              %option{ value: 'popularity_asc', selected: @sort == 'popularity_asc' }
                = t(:popularity_asc)
            %optgroup{ label: t(:publication_date) }
              %option{ value: 'publication_date_asc', selected: @sort == 'publication_date_asc' }
                = t(:pubdate_asc)
              %option{ value: 'publication_date_desc', selected: @sort == 'publication_date_desc' }
                = t(:pubdate_desc)

  .mainlist#browse_mainlist
    %ol{ style: "counter-reset:li #{(@page.to_i - 1) * FilteringAndPaginationConcern::PAGE_SIZE}" }
      - decorator = browse_collection_decorator_by_sort_type(@sort)
      - @collections.each do |c|
        %li
          = collection_type_icon(c.collection_type)
          = link_to c.title, collection_path(c.id)
          %br
          - authorities_str = format_collection_authorities(c)
          - if authorities_str.present?
            %span.collection-authorities= authorities_str
          - items_count = c.collection_items.count rescue 0
          - if items_count > 0
            %span.collection-items-count= " â€¢ #{items_count} #{t(:items)}"
          = decorator.call(c)
  = hidden_field_tag(:hurl, request.original_url)
  = render partial: 'shared/filters/pagination', locals: { form_id: 'collections_filters', add_js: true }
:javascript
  $(document).ready(function() {
    $('.tag-x').click(function(){
      const field = $(this).data('ele');

      if($(this).attr('data-which') == 'text') {
        $('#collections_filters #' + field).val('');
      } else if ($(this).attr('data-which') == 'authoritylist') {
        $('#collections_filters #authority_ids').val('');
        $('#collections_filters #authorities_names').val('');
        $('#collections_filters input[name="ckb_authorities[]"]').prop('checked', false);
      } else if (field.startsWith('tag_')) {
        // Handle tag filters - remove the specific tag ID from the comma-separated list
        const tagId = field.replace('tag_', '');
        const currentValue = $('#collections_filters #tag_ids').val() || '';
        const tagIds = currentValue.split(',').map(function(id) { return id.trim(); })
                                    .filter(function(id) { return id && id !== tagId; })
                                    .join(',');
        $('#collections_filters #tag_ids').val(tagIds);
      } else {
        $('#collections_filters #' + field).prop("checked", false);
      }
      // and submit the form
      $('input').attr('disabled', false); // re-enable checkboxes to preserve other filters

      submit_filters();
    });

    $('#sort_by_dd').change(function(){
      $('input[name=sort_by]').val($('#sort_by_dd option:selected').val());
      submit_filters();
    });
  });
