{"id":"by-0d2","title":"Add a sorted-comparison method to Authority","description":"The method should:\n1. gather the authority's name and all alternate names (in other_designation field, semicolon-separated)\n2. SORT each name alphabetically (i.e. \"James Smith\" would remain \"James Smith\", but \"Robert Ames\" would become \"Ames Robert\" and \"James Clark Maxwell\" would become \"Clark James Maxwell\")\n3. return a sorted array of those sorted names.\n\nThis method will then be used for efficient comparisons with names that will be likewise sorted.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T05:11:50.150299874+02:00","updated_at":"2025-12-07T05:17:38.22807896+02:00","closed_at":"2025-12-07T05:17:38.22807896+02:00"}
{"id":"by-1l5","title":"Implement ES filter building methods in CollectionsController","description":"Create methods: es_prep_collection (similar to manifestation), build_es_filter_from_filters, prepare_totals for aggregations","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T03:22:10.217234152+02:00","updated_at":"2025-12-10T03:24:39.660831759+02:00","closed_at":"2025-12-10T03:24:39.660831759+02:00","dependencies":[{"issue_id":"by-1l5","depends_on_id":"by-88o","type":"blocks","created_at":"2025-12-10T03:22:26.055650677+02:00","created_by":"daemon"},{"issue_id":"by-1l5","depends_on_id":"by-c8b","type":"blocks","created_at":"2025-12-10T03:22:26.100581204+02:00","created_by":"daemon"}]}
{"id":"by-1zz","title":"Investigate scrollspy offset","description":"In the Manifestation#read view the chapter navbar uses the scrollspy feature to highlight the chapter the user is currently viewing. This is not working QUITE accurately. In many cases, the LAST chapter is highlighted upon page load, before the user scrolls anywhere. Also, while scrolling, the chapter highlight is a little off to what we would expect. Please investigate the current implementation and propose an explanation for this behavior. If you do identify a clear problem, fix it. REMEMBER the instructions in AGENTS.md about working in a feature branch and not pushing anything to existing branches; your work should be submitted as a PR on GitHub (i.e. origin/master)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-03T02:59:17.984104866+02:00","updated_at":"2025-12-03T03:03:01.55192329+02:00","closed_at":"2025-12-03T03:03:01.55192329+02:00"}
{"id":"by-2xv","title":"Implement dict print page","description":"Print button does not works on a dict page \n\nE.g. if we open https://benyehuda.org/dict/24412/ and press 'print' button in a toolbar in top-left corner it opens empty page.\nCode expects @print_url variable to be set, but it is empty.\n\nImplement a printable view of the dictionary list and of individual dictionary entries, modelled on the existing #print action for Manifestations.\n\nWhen committing this feature, mention \"Fixed #717\" in the commit message.\n\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-02T21:35:21.536525593+02:00","updated_at":"2025-12-02T21:44:24.821629296+02:00","closed_at":"2025-12-02T21:44:24.821629296+02:00"}
{"id":"by-3tc","title":"Write tests for collections browse functionality","description":"Add controller specs for browse action, filter building, ES queries. Add feature specs for filter interaction, pagination, AJAX behavior","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T03:22:13.81763865+02:00","updated_at":"2025-12-10T03:34:10.469687222+02:00","closed_at":"2025-12-10T03:34:10.469687222+02:00","dependencies":[{"issue_id":"by-3tc","depends_on_id":"by-saj","type":"blocks","created_at":"2025-12-10T03:22:26.384439743+02:00","created_by":"daemon"},{"issue_id":"by-3tc","depends_on_id":"by-uxj","type":"blocks","created_at":"2025-12-10T03:22:26.414888104+02:00","created_by":"daemon"},{"issue_id":"by-3tc","depends_on_id":"by-nzm","type":"blocks","created_at":"2025-12-10T03:22:26.447291803+02:00","created_by":"daemon"}]}
{"id":"by-5bq","title":"Reindex collections in Elasticsearch","description":"After ES index updates, run reindexing task to populate new fields in all collection documents","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T03:22:14.377553128+02:00","updated_at":"2025-12-10T03:34:17.219394666+02:00","closed_at":"2025-12-10T03:34:17.219394666+02:00","dependencies":[{"issue_id":"by-5bq","depends_on_id":"by-88o","type":"blocks","created_at":"2025-12-10T03:22:26.476732125+02:00","created_by":"daemon"}]}
{"id":"by-6vm","title":"Add view rendering tests for collections browse","description":"Add request/feature specs that actually render the browse views to catch HAML syntax errors and missing instance variables","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T04:19:46.557329285+02:00","updated_at":"2025-12-10T04:37:31.997945214+02:00","closed_at":"2025-12-10T04:37:31.997945214+02:00"}
{"id":"by-6wh","title":"Fix ES sort_title field type error in CollectionsIndex","description":"sort_title needs to be a keyword field for sorting, not a text field","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-10T04:01:08.091657666+02:00","updated_at":"2025-12-10T04:14:18.808036449+02:00","closed_at":"2025-12-10T04:14:18.808036449+02:00"}
{"id":"by-7ed","title":"Create _browse_filters.html.haml partial","description":"Create filter form partial with: title search, collection type checkboxes, authorities autocomplete, tags, date range, sort dropdown, reset button","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T03:22:11.202887142+02:00","updated_at":"2025-12-10T03:26:57.159715149+02:00","closed_at":"2025-12-10T03:26:57.159715149+02:00"}
{"id":"by-88o","title":"Update CollectionsIndex with additional ES fields","description":"Add fields to CollectionsIndex: sort_title, tags, involved_authority_ids, involved_authority_roles, first_letter, items_count, inception_year, normalized_pub_year. Update spec if needed.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T03:22:08.456137074+02:00","updated_at":"2025-12-10T03:22:58.836600279+02:00","closed_at":"2025-12-10T03:22:58.836600279+02:00"}
{"id":"by-a8u","title":"Create _browse_list.html.haml partial","description":"Create results list partial with: spinner, result count, pagination controls, collection list items with type icons/authorities/metadata, alphabetical pagination","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T03:22:11.667560192+02:00","updated_at":"2025-12-10T03:27:37.953259747+02:00","closed_at":"2025-12-10T03:27:37.953259747+02:00","dependencies":[{"issue_id":"by-a8u","depends_on_id":"by-d3o","type":"blocks","created_at":"2025-12-10T03:22:26.195130035+02:00","created_by":"daemon"}]}
{"id":"by-c8b","title":"Include FilteringAndPaginationConcern in CollectionsController","description":"Add FilteringAndPaginationConcern to CollectionsController to enable pagination support","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T03:22:09.328880088+02:00","updated_at":"2025-12-10T03:23:27.43902169+02:00","closed_at":"2025-12-10T03:23:27.43902169+02:00"}
{"id":"by-d3o","title":"Add collection display helper methods","description":"Create helper methods for: browse_item_decorator_by_sort_type, collection type icons/badges, display format for involved authorities, publication year display","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T03:22:13.275308429+02:00","updated_at":"2025-12-10T03:25:44.088954052+02:00","closed_at":"2025-12-10T03:25:44.088954052+02:00"}
{"id":"by-dwr","title":"Create _browse_top.html.haml partial","description":"Create header partial with: title, filter toggle button, result count, responsive layout","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T03:22:12.220574387+02:00","updated_at":"2025-12-10T03:26:09.483656149+02:00","closed_at":"2025-12-10T03:26:09.483656149+02:00"}
{"id":"by-gxg","title":"don't show unpublished dictionaries","description":"Manifestation#dict action allows to view unpublished dictionaries. In Manifestation#read we check if manifestaion is published and allow to view unpublished only to editors. But we lack this check in Manifestation#dict.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-02T20:50:35.0257105+02:00","updated_at":"2025-12-02T20:55:21.27012657+02:00","closed_at":"2025-12-02T20:55:21.27012657+02:00"}
{"id":"by-nzm","title":"Create browse.js.erb AJAX response template","description":"Create JS template that updates #thelist and #sort_filter_panel divs with rendered partials and stops spinner","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T03:22:12.724132497+02:00","updated_at":"2025-12-10T03:28:27.21598271+02:00","closed_at":"2025-12-10T03:28:27.21598271+02:00","dependencies":[{"issue_id":"by-nzm","depends_on_id":"by-a8u","type":"blocks","created_at":"2025-12-10T03:22:26.327002741+02:00","created_by":"daemon"},{"issue_id":"by-nzm","depends_on_id":"by-7ed","type":"blocks","created_at":"2025-12-10T03:22:26.356281534+02:00","created_by":"daemon"}]}
{"id":"by-oox","title":"Add collections browse route to routes.rb","description":"Add 'match collections, to: collections#browse' route for the browse interface","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T03:22:08.896132863+02:00","updated_at":"2025-12-10T03:23:12.31368601+02:00","closed_at":"2025-12-10T03:23:12.31368601+02:00"}
{"id":"by-qhv","title":"Design and implement a Collections list and browsing interface","description":"Style it after the /works view for listing Manifestations, with appropriate adjustments for the data available for Collections, when selecting what filters are appropriate to implement.  Once you have completed a DESIGN and a planned task list, PAUSE for human input and take any offered input into consideration before implementing.","design":"## Collections Browse Interface Design\n\n### Architecture Overview\n\nThe Collections browse interface will follow the proven pattern established by the `/works` (Manifestations) browse view, adapting it for Collection-specific data and filters. The implementation will leverage existing infrastructure:\n\n- **Elasticsearch**: Use existing `CollectionsIndex` for search/filtering\n- **Controller Pattern**: Add `browse` action to `CollectionsController` with `FilteringAndPaginationConcern`\n- **View Structure**: Two-column layout with filters sidebar and results list\n- **Pagination**: Search-after cursor-based pagination (not offset)\n- **AJAX**: Form auto-submit with spinner feedback\n\n### Data Model\n\n**Collections indexed in Elasticsearch:**\n- `id` - Collection ID\n- `title` - Main title\n- `alternate_titles` - Alternate titles\n- `subtitle` - Subtitle\n- `collection_type` - Enum: volume, periodical, series, other (excludes periodical_issue, uncollected)\n- `involved_authorities_string` - Comma-separated authority names\n- `impressions_count` - Popularity metric\n\n**Additional fields to add to CollectionsIndex:**\n- `sort_title` - For alphabetical sorting (diacritics removed)\n- `tags` - Tag IDs for filtering\n- `involved_authority_ids` - Authority IDs for filtering by specific people\n- `involved_authority_roles` - For filtering by role (author/editor/translator/illustrator)\n- `first_letter` - For alphabetical pagination\n- `inception_year` - Publication year from inception_year field\n- `normalized_pub_year` - Normalized publication year\n- `items_count` - Count of collection items\n\n### Routes\n\nAdd to `config/routes.rb`:\n```ruby\nmatch 'collections', to: 'collections#browse', as: 'collections_browse', via: %i(get post)\n```\n\nThis creates a `/collections` browse route (distinct from `/collections/:id` show route).\n\n### Controller Components\n\n**CollectionsController#browse**:\n1. Include `FilteringAndPaginationConcern`\n2. Process filter parameters\n3. Build Elasticsearch query with filters\n4. Paginate results (100 per page)\n5. Calculate facet aggregations for filter counts\n6. Render browse view (HTML or JS for AJAX)\n\n**Filter Parameters**:\n- `search_input` - Title search\n- `ckb_collection_types[]` - Collection type checkboxes\n- `ckb_involved_authorities[]` - Authority IDs (with autocomplete)\n- `tag_ids` - Comma-separated tag IDs\n- `fromdate`, `todate` - Publication date range (uses inception_year or normalized_pub_year)\n- `sort_by` - Sort option (alphabetical, popularity, publication_date)\n- Pagination: `page`, `search_after_value`, `search_after_id`, `reverse`, `to_letter`\n\n**Elasticsearch Aggregations** (for facet counts):\n- Collection types (with counts)\n- Tags (with counts)\n- Involved authorities (top 2000, with counts)\n\n### View Structure\n\n**Main View** (`app/views/collections/browse.html.haml`):\n- Two-column responsive layout\n- Left: Filter sidebar (collapsible on mobile)\n- Right: Results list with pagination\n- AJAX form submission on filter change (desktop auto-submit, mobile manual)\n\n**Partials**:\n1. `_browse_top.html.haml` - Header with:\n   - Title (\"Collections\")\n   - Filter toggle button\n   - Result count\n   - Sort dropdown\n\n2. `_browse_filters.html.haml` - Filter form with:\n   - Search box (collection title)\n   - Collection Type checkboxes (volume, periodical, series, other) with icons\n   - Involved Authorities autocomplete (by name)\n   - Tags autocomplete\n   - Publication Date Range (fromdate, todate with date picker)\n   - Sort dropdown (alphabetical, popularity, publication_date)\n   - Reset filters button\n   - Hidden pagination fields\n\n3. `_browse_list.html.haml` - Results list:\n   - Spinner loading indicator\n   - Result count and active filter tags\n   - Pagination controls (top)\n   - Ordered list of collections:\n     - Collection type icon/badge\n     - Title (linked to collection show page)\n     - Involved authorities\n     - Publication year (when sorted by date)\n     - Item count (optional decorator)\n   - Pagination controls (bottom)\n   - Alphabetical pagination (A-Z)\n\n4. `browse.js.erb` - AJAX response:\n   ```javascript\n   $('#thelist').html(\"\u003c%= j(render partial: 'browse_list') %\u003e\");\n   $('#sort_filter_panel').html(\"\u003c%= j(render partial: 'browse_filters') %\u003e\");\n   stopModal('spinnerdiv');\n   ```\n\n### Filters Implementation\n\n**Title Search** (ES match query):\n- Field: `title`\n- Type: `match_phrase` for phrase matching\n\n**Collection Type** (ES terms query):\n- Field: `collection_type`\n- Values: volume, periodical, series, other\n- UI: Checkboxes with type-specific icons\n\n**Involved Authorities** (ES terms query):\n- Field: `involved_authority_ids`\n- UI: Autocomplete search (similar to works author search)\n- Display format: \"Author Name (role)\"\n\n**Tags** (ES terms query):\n- Field: `tags`\n- UI: Autocomplete with tag removal\n\n**Publication Date Range** (ES range query):\n- Fields: `normalized_pub_year` (primary) or `inception_year` (fallback)\n- Logic: Use normalized_pub_year if present, otherwise inception_year\n- UI: Two date pickers (fromdate, todate) with year-only format\n- Query: Range filter on the year field\n\n**Sort Options**:\n- `alphabetical` - Sort by `sort_title` ASC\n- `popularity` - Sort by `impressions_count` DESC\n- `publication_date` - Sort by publication year (normalized_pub_year or inception_year) ASC\n\n### Display Fields\n\n**List Item Display**:\n```\n[Type Icon] Collection Title\n            By: Author 1, Editor 2 • Contains X items • Published: YYYY\n```\n\nWhere:\n- Type icon: Visual badge for volume/periodical/series/other\n- Title: Links to collection show page\n- Involved authorities: First 2-3 names with roles\n- Item count: Number of collection_items\n- Publication year: Shown when available\n\n**Decorator Pattern**:\nCreate helper method to show different metadata based on sort:\n- Alphabetical: Show collection type\n- Popularity: Show impressions count\n- Publication date: Show publication year\n\n### Pagination\n\n**Strategy**: Search-after cursor pagination (same as works)\n- Page size: 100 items\n- No traditional offset (efficient for large datasets)\n- Next/Previous with cursor values\n- Alphabetical jump (A-Z letters)\n\n**Parameters**:\n- `page` - Display page number\n- `search_after_value` - Sort field value of cursor item\n- `search_after_id` - ID of cursor item\n- `reverse` - Boolean for previous page\n- `to_letter` - Jump to alphabetical section\n\n### JavaScript Components\n\n**Auto-submit** (desktop):\n- 300ms debounce on filter changes\n- Reset pagination on new filter\n- Show spinner during load\n\n**Filter Management**:\n- Tag removal via X buttons\n- Reset all filters button\n- Authority autocomplete selection\n- Date picker integration (Tempusdominus)\n\n**Pagination**:\n- Letter button click handlers\n- Next/Previous page navigation\n- First page button\n\n**Mobile Responsiveness**:\n- Filters in collapsible panel\n- Manual submit button\n- Simplified layout\n\n### Elasticsearch Index Enhancements\n\nUpdate `CollectionsIndex` to add:\n```ruby\nfield :sort_title\nfield :tags, value: -\u003e(c) { c.tags.pluck(:id) }\nfield :involved_authority_ids, value: -\u003e(c) { \n  c.involved_authorities.pluck(:authority_id) \n}\nfield :involved_authority_roles, value: -\u003e(c) {\n  c.involved_authorities.pluck(:role).uniq\n}\nfield :first_letter, value: -\u003e(c) { \n  c.sort_title.present? ? c.sort_title[0].downcase : 'א'\n}\nfield :items_count, type: :integer, value: -\u003e(c) { \n  c.collection_items.count \n}\nfield :inception_year, type: :integer\nfield :normalized_pub_year, type: :integer\n```\n\n### Dependencies \u0026 Constraints\n\n**Existing Infrastructure to Leverage**:\n- `FilteringAndPaginationConcern` - Pagination logic\n- `CollectionsIndex` - Elasticsearch index (needs enhancements)\n- `RecordWithInvolvedAuthorities` - Authority relationships\n- Tag autocomplete helpers\n- Similar CSS/JS patterns from works browse\n- Date picker (Tempusdominus Bootstrap 4)\n\n**Technical Constraints**:\n- Exclude `periodical_issue` and `uncollected` from browse (already filtered in index scope)\n- Must handle RTL (Hebrew) text properly\n- Mobile-responsive design required\n- AJAX responses must update multiple page sections\n- Publication date uses normalized_pub_year if available, otherwise inception_year\n\n**Performance Considerations**:\n- Elasticsearch aggregations can be expensive - limit facet size\n- Cache filter counts where possible\n- Use search-after for efficient pagination\n\n### Testing Strategy\n\n1. **Unit Tests**: Controller filter building, ES query construction\n2. **Integration Tests**: Full browse workflow with filters\n3. **Feature Tests**: AJAX submission, pagination, filter interaction\n4. **Search Tests**: Verify ES queries return correct results\n\n### Success Metrics\n\n- Browse page loads in \u003c2s with 1000+ collections\n- Filters respond instantly (\u003c300ms)\n- Pagination works smoothly without offset limits\n- Mobile experience is usable\n- Follows established UX patterns from /works view","acceptance_criteria":"- [ ] All child issues are completed\n- [ ] Integration tests pass\n- [ ] Documentation is updated\n- [ ] Code review completed\n","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-10T03:06:35.656630515+02:00","updated_at":"2025-12-10T03:34:34.469335221+02:00","closed_at":"2025-12-10T03:34:34.469335221+02:00","labels":["epic"]}
{"id":"by-saj","title":"Implement CollectionsController#browse action","description":"Create browse action that: 1) Builds ES query with filters, 2) Paginates results, 3) Calculates aggregations, 4) Renders browse view or JS response","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T03:22:09.78139674+02:00","updated_at":"2025-12-10T03:25:13.308760001+02:00","closed_at":"2025-12-10T03:25:13.308760001+02:00","dependencies":[{"issue_id":"by-saj","depends_on_id":"by-1l5","type":"blocks","created_at":"2025-12-10T03:22:26.133318991+02:00","created_by":"daemon"},{"issue_id":"by-saj","depends_on_id":"by-oox","type":"blocks","created_at":"2025-12-10T03:22:26.163129574+02:00","created_by":"daemon"}]}
{"id":"by-uxj","title":"Create browse.html.haml main view for collections","description":"Create app/views/collections/browse.html.haml with two-column layout, filter sidebar, results area, and JS for filter interaction","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T03:22:10.700521537+02:00","updated_at":"2025-12-10T03:28:15.786878429+02:00","closed_at":"2025-12-10T03:28:15.786878429+02:00","dependencies":[{"issue_id":"by-uxj","depends_on_id":"by-dwr","type":"blocks","created_at":"2025-12-10T03:22:26.236143193+02:00","created_by":"daemon"},{"issue_id":"by-uxj","depends_on_id":"by-7ed","type":"blocks","created_at":"2025-12-10T03:22:26.266345871+02:00","created_by":"daemon"},{"issue_id":"by-uxj","depends_on_id":"by-a8u","type":"blocks","created_at":"2025-12-10T03:22:26.296887243+02:00","created_by":"daemon"}]}
{"id":"by-z2o","title":"Add ES integration tests for collections browse","description":"Add tests that actually execute ES queries to catch field type errors and query issues","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T04:01:08.419709286+02:00","updated_at":"2025-12-10T04:14:18.810296498+02:00","closed_at":"2025-12-10T04:14:18.810296498+02:00"}
